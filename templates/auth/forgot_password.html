<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ZENTRO | Forgot Password</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

<!-- ðŸ” reCAPTCHA v3 ONLY -->
<script src="https://www.google.com/recaptcha/api.js?render={{ config.RECAPTCHA_SITE_KEY }}"></script>

<style>
body{
  font-family:'Inter',sans-serif;
  background:linear-gradient(135deg,#1f2933,#3a2f1c);
  min-height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
}
.auth-box{
  background:#fff;
  border-radius:16px;
  box-shadow:0 25px 60px rgba(0,0,0,.25);
  max-width:420px;
  width:100%;
  padding:40px 35px;
}
.brand{
  font-size:24px;
  font-weight:800;
  text-align:center;
  margin-bottom:6px;
}
.brand span{color:#d4a24c;}
.subtitle{
  text-align:center;
  font-size:14px;
  color:#666;
  margin-bottom:22px;
}
.info-box{
  background:#f8f6f2;
  border-left:4px solid #d4a24c;
  padding:12px;
  border-radius:8px;
  font-size:13px;
  margin-bottom:20px;
  color:#444;
}
.form-control{
  border-radius:10px;
  padding:12px 42px;
  font-size:14px;
}
.icon-input{position:relative;}
.icon-input i{
  position:absolute;
  left:14px;
  top:50%;
  transform:translateY(-50%);
  color:#888;
}
.btn-primary{
  background:#2d2a26;
  border:none;
  border-radius:10px;
  padding:12px;
  font-weight:600;
}
.btn-primary:hover{background:#1f1c19;}
.btn-primary:disabled{opacity:0.7;}
.back-link{
  text-align:center;
  margin-top:16px;
}
.back-link a{
  text-decoration:none;
  font-weight:600;
  color:#2d2a26;
  font-size:13px;
}
</style>
</head>

<body>

<div class="auth-box">

  <div class="brand">
    <i class="fa-solid fa-bag-shopping me-1"></i>
    ZENT<span>RO</span>
  </div>

  <div class="subtitle">
    Forgot your password? Weâ€™ve got you covered.
  </div>

  {% with messages = get_flashed_messages(with_categories=true) %}
  {% for category, message in messages %}
  <div class="alert alert-{{ category }} alert-dismissible fade show">
    {{ message }}
    <button class="btn-close" data-bs-dismiss="alert"></button>
  </div>
  {% endfor %}
  {% endwith %}

  <div class="info-box">
    <i class="fa-solid fa-circle-info me-1"></i>
    Enter your registered email address.
    Weâ€™ll send a <b>6-digit OTP</b> to verify your identity.
  </div>

  <!-- âœ… FORM -->
 <form id="forgotForm"
      method="POST"
      action="{{ url_for('auth.forgot_password') }}"
      onsubmit="executeRecaptcha(event)">

  <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">


    <div class="mb-3 icon-input">
      <i class="fa-solid fa-envelope"></i>
      <input type="email"
             class="form-control"
             name="email"
             placeholder="Registered email address"
             required>
    </div>

    <!-- ðŸ” v3 token -->
    <input type="hidden" name="g-recaptcha-response" id="recaptchaToken">

    <button id="submitBtn" type="submit" class="btn btn-primary w-100">
      <span id="btnText">
        <i class="fa-solid fa-paper-plane me-1"></i>
        Send OTP
      </span>
    </button>

  </form>

  <div class="back-link">
    <a href="{{ url_for('auth.login') }}">
      <i class="fa-solid fa-arrow-left me-1"></i>
      Back to Login
    </a>
  </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
function executeRecaptcha(event){
  event.preventDefault();

  const btn = document.getElementById("submitBtn");
  const text = document.getElementById("btnText");

  btn.disabled = true;
  text.innerHTML = `
    <span class="spinner-border spinner-border-sm me-1"></span>
    Sending OTP...
  `;

  grecaptcha.ready(function(){
    grecaptcha.execute("{{ config.RECAPTCHA_SITE_KEY }}", {
      action: "forgot_password"
    }).then(function(token){
      document.getElementById("recaptchaToken").value = token;
      document.getElementById("forgotForm").submit();
    });
  });
}
</script>

</body>
</html>
