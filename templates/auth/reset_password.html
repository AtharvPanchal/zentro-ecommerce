<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ZENTRO | Reset Password</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Bootstrap -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<!-- Font Awesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<!-- Google Font -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
body{
  font-family:'Inter',sans-serif;
  background:linear-gradient(135deg,#20272f,#3a2f1c);
  min-height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
}

.auth-box{
  background:#fff;
  border-radius:18px;
  box-shadow:0 25px 60px rgba(0,0,0,.28);
  max-width:440px;
  width:100%;
  padding:45px 40px;
}

.brand{
  font-size:26px;
  font-weight:800;
  text-align:center;
  margin-bottom:8px;
}
.brand span{color:#d4a24c;}

.subtitle{
  text-align:center;
  font-size:14px;
  color:#666;
  margin-bottom:22px;
}

.security-note{
  background:#f8f6f2;
  border-left:4px solid #d4a24c;
  padding:12px;
  border-radius:8px;
  font-size:13px;
  margin-bottom:20px;
}

.icon-input{
  position:relative;
}
.icon-input i.left{
  position:absolute;
  left:14px;
  top:50%;
  transform:translateY(-50%);
  color:#888;
}
.icon-input i.right{
  position:absolute;
  right:14px;
  top:50%;
  transform:translateY(-50%);
  cursor:pointer;
  color:#888;
}

.form-control{
  border-radius:10px;
  padding:12px 42px;
  font-size:14px;
}

.progress{
  height:6px;
  border-radius:6px;
  margin-bottom:12px;
}

.password-rules small{
  display:block;
  font-size:12px;
  margin-bottom:3px;
}

.match-text{
  font-size:12px;
  margin-top:4px;
}

.btn-primary{
  background:#2d2a26;
  border:none;
  padding:12px;
  border-radius:10px;
  font-weight:600;
}
.btn-primary:hover{background:#1f1c19;}
.btn-primary:disabled{opacity:.7;}

.back-link{
  text-align:center;
  margin-top:18px;
}
.back-link a{
  text-decoration:none;
  color:#2d2a26;
  font-weight:600;
  font-size:13px;
}
</style>
</head>

<body>

<div class="auth-box">

  <!-- BRAND -->
  <div class="brand">
    <i class="fa-solid fa-shield-halved me-1"></i>ZENT<span>RO</span>
  </div>
  <div class="subtitle">
    Create a new secure password for your account
  </div>

  <!-- SECURITY INFO -->
  <div class="security-note">
    <i class="fa-solid fa-lock me-1"></i>
    For your security, choose a strong password you haven’t used before.
  </div>

  <!-- FLASH -->
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% for category, message in messages %}
      <div class="alert alert-{{ category }} alert-dismissible fade show">
        {{ message }}
        <button class="btn-close" data-bs-dismiss="alert"></button>
      </div>
    {% endfor %}
  {% endwith %}

  <!-- FORM -->
  <form method="POST"
        action="{{ url_for('auth.reset_password', email=email) }}"
        onsubmit="submitBtn()">

    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

    <!-- NEW PASSWORD -->
    <div class="mb-3 icon-input">
      <i class="fa-solid fa-lock left"></i>
      <input type="password"
             id="newPass"
             name="password"
             class="form-control"
             placeholder="New password"
             oninput="checkStrength()"
             required>
      <i class="fa-solid fa-eye right" onclick="togglePassword('newPass',this)"></i>
    </div>

    <!-- STRENGTH -->
    <div class="progress">
      <div id="strengthBar" class="progress-bar bg-danger" style="width:0%"></div>
    </div>

    <!-- REQUIREMENTS -->
    <div class="password-rules mb-3">
      <small id="r1" class="text-danger">• Minimum 8 characters</small>
      <small id="r2" class="text-danger">• At least one uppercase letter</small>
      <small id="r3" class="text-danger">• At least one number</small>
    </div>

    <!-- CONFIRM -->
    <div class="mb-4 icon-input">
      <i class="fa-solid fa-lock left"></i>
      <input type="password"
             id="confirmPass"
             name="confirm_password"
             class="form-control"
             placeholder="Confirm new password"
             oninput="checkMatch()"
             required>
      <i class="fa-solid fa-eye right" onclick="togglePassword('confirmPass',this)"></i>
    </div>

    <div id="matchText" class="match-text text-muted mb-3"></div>

    <button id="resetBtn" class="btn btn-primary w-100">
      <span id="btnText">
        <i class="fa-solid fa-rotate me-1"></i>
        Reset Password
      </span>
    </button>

  </form>

  <div class="back-link">
    <a href="{{ url_for('auth.login') }}">
      <i class="fa-solid fa-arrow-left me-1"></i> Back to Login
    </a>
  </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
function togglePassword(id, icon){
  const input=document.getElementById(id);
  if(input.type==="password"){
    input.type="text";
    icon.classList.replace("fa-eye","fa-eye-slash");
  }else{
    input.type="password";
    icon.classList.replace("fa-eye-slash","fa-eye");
  }
}

function checkStrength(){
  const v=newPass.value;
  let s=0;

  if(v.length>=8){r1.className="text-success";s++;}else r1.className="text-danger";
  if(/[A-Z]/.test(v)){r2.className="text-success";s++;}else r2.className="text-danger";
  if(/[0-9]/.test(v)){r3.className="text-success";s++;}else r3.className="text-danger";

  strengthBar.style.width=(s/3*100)+"%";
  strengthBar.className="progress-bar "+(s==3?"bg-success":s==2?"bg-warning":"bg-danger");
}

function checkMatch(){
  if(confirmPass.value===""){
    matchText.innerHTML="";
    return;
  }
  if(confirmPass.value===newPass.value){
    matchText.innerHTML="<span class='text-success'>✔ Passwords match</span>";
  }else{
    matchText.innerHTML="<span class='text-danger'>✖ Passwords do not match</span>";
  }
}

function submitBtn(){
  resetBtn.disabled=true;
  btnText.innerHTML=
    "<span class='spinner-border spinner-border-sm me-1'></span> Updating...";
}
</script>

</body>
</html>
