<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ZENTRO | Verify OTP</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
body{
  font-family:'Inter',sans-serif;
  background:linear-gradient(135deg,#1f2933,#3a2f1c);
  min-height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
}
.auth-box{
  background:#fff;
  border-radius:16px;
  box-shadow:0 25px 60px rgba(0,0,0,.25);
  max-width:420px;
  width:100%;
  padding:40px 35px;
}
.brand{font-size:24px;font-weight:800;text-align:center;margin-bottom:6px;}
.brand span{color:#d4a24c;}
.subtitle{text-align:center;font-size:14px;color:#666;margin-bottom:20px;}
.info-box{
  background:#f8f6f2;
  border-left:4px solid #d4a24c;
  padding:12px;
  border-radius:8px;
  font-size:13px;
  margin-bottom:20px;
}
.otp-inputs{display:flex;justify-content:space-between;gap:10px;margin-bottom:20px;}
.otp-inputs input{
  width:48px;height:52px;text-align:center;font-size:20px;
  font-weight:600;border-radius:10px;border:1px solid #ccc;
}
.otp-inputs input:focus{
  border-color:#d4a24c;outline:none;
  box-shadow:0 0 0 2px rgba(212,162,76,.2);
}
.btn-primary{background:#2d2a26;border:none;border-radius:10px;padding:12px;font-weight:600;}
.btn-primary:hover{background:#1f1c19;}
.resend{text-align:center;margin-top:15px;font-size:13px;}
.resend a{font-weight:600;color:#2d2a26;text-decoration:none;}
.back-link{text-align:center;margin-top:10px;}
.back-link a{font-size:13px;font-weight:600;color:#555;text-decoration:none;}
</style>
</head>

<body>

<div class="auth-box">

<div class="brand">
  <i class="fa-solid fa-shield-keyhole me-1"></i>ZENT<span>RO</span>
</div>
<div class="subtitle">Secure verification</div>

{% with messages = get_flashed_messages(with_categories=true) %}
{% if messages %}
{% for category, message in messages %}
<div class="alert alert-{{ category }} alert-dismissible fade show">
  {{ message }}
  <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
</div>
{% endfor %}
{% endif %}
{% endwith %}

<div class="info-box">
  <i class="fa-solid fa-envelope-open-text me-1"></i>
  Enter the 6-digit OTP sent to <b>{{ email }}</b>
</div>

<form method="POST"
      action="{{ url_for('auth.verify_otp_route', email=email) }}"
      onsubmit="handleSubmit()">

  <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">


<input type="hidden" name="otp" id="otpHidden">

<div class="otp-inputs">
  <input type="text" maxlength="1" class="otp" oninput="moveNext(this, event)">
  <input type="text" maxlength="1" class="otp" oninput="moveNext(this, event)">
  <input type="text" maxlength="1" class="otp" oninput="moveNext(this, event)">
  <input type="text" maxlength="1" class="otp" oninput="moveNext(this, event)">
  <input type="text" maxlength="1" class="otp" oninput="moveNext(this, event)">
  <input type="text" maxlength="1" class="otp" oninput="moveNext(this, event)">
</div>

<button id="verifyBtn" class="btn btn-primary w-100">
  <i class="fa-solid fa-circle-check me-1"></i>
  Verify OTP
</button>

</form>

<div class="resend">
Didnâ€™t receive OTP?
<br>
<span id="timerText" class="text-muted">
Resend in <b id="countdown">5:00</b>
</span>

<a id="resendLink"
   href="{{ url_for('auth.forgot_password') }}"
   style="pointer-events:none; opacity:0.4;">
   Resend OTP
</a>
</div>

<div class="back-link">
<a href="{{ url_for('auth.login') }}">
<i class="fa-solid fa-arrow-left me-1"></i> Back to Login
</a>
</div>

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
function moveNext(el, e){
  if(el.value.length === 1 && el.nextElementSibling) el.nextElementSibling.focus();
  if(e.inputType === "deleteContentBackward" && el.previousElementSibling) el.previousElementSibling.focus();
}

function handleSubmit(){
  let otp="";
  document.querySelectorAll(".otp").forEach(i=>otp+=i.value);
  document.getElementById("otpHidden").value = otp;

  // prevent double submit
  document.getElementById("verifyBtn").disabled = true;
}

// ------------------------
// OTP TIMER (5 MINUTES)
// ------------------------
let totalSeconds = 5 * 60;
const countdownEl = document.getElementById("countdown");
const resendLink = document.getElementById("resendLink");
const timerText = document.getElementById("timerText");

const timer = setInterval(()=>{
  totalSeconds--;

  let m = Math.floor(totalSeconds / 60);
  let s = totalSeconds % 60;
  countdownEl.innerText = `${m}:${s.toString().padStart(2,"0")}`;

  if(totalSeconds <= 0){
    clearInterval(timer);
    timerText.innerHTML = "<span class='text-success'>You can resend OTP now</span>";
    resendLink.style.pointerEvents="auto";
    resendLink.style.opacity="1";
  }
},1000);
</script>

</body>
</html>
