{% extends "base.html" %}
{% block title %}My Wishlist{% endblock %}

{% block content %}
<div class="container py-5">

  <div class="d-flex justify-content-between align-items-center mb-4">
    <h4 class="fw-bold">❤️ My Wishlist</h4>
    <span class="text-muted">{{ items|length }} items</span>
  </div>

  <!-- FILTER BAR -->
  <form method="GET" class="card shadow-sm mb-4">
    <div class="card-body row g-3 align-items-end">

      <div class="col-md-4">
        <label class="form-label">Search</label>
        <input class="form-control"
               name="search"
               value="{{ search }}"
               placeholder="Search products">
      </div>

      <div class="col-md-3">
        <label class="form-label">Sort</label>
        <select class="form-select" name="sort">
          <option value="">Newest</option>
          <option value="low" {% if sort=='low' %}selected{% endif %}>Price: Low → High</option>
          <option value="high" {% if sort=='high' %}selected{% endif %}>Price: High → Low</option>
        </select>
      </div>

      <div class="col-md-3">
        <label class="form-label">Status</label>
        <select class="form-select" name="status">
          <option value="all">All</option>
          <option value="purchased" {% if status=='purchased' %}selected{% endif %}>Purchased</option>
          <option value="unpurchased" {% if status=='unpurchased' %}selected{% endif %}>Unpurchased</option>
        </select>
      </div>

      <div class="col-md-2">
        <button class="btn btn-dark w-100">Apply</button>
      </div>

    </div>
  </form>

  <!-- WISHLIST ITEMS -->
  <div class="row g-4">
    {% for w, product in items %}
    <div class="col-lg-3 col-md-4 col-sm-6">
      <div class="card h-100 shadow-sm wishlist-card">

        <img src="{{ product.image_url }}"
             class="card-img-top"
             style="height:200px;object-fit:cover;">

        <div class="card-body d-flex flex-column">
          <h6 class="fw-semibold mb-1">{{ product.name }}</h6>
          <p class="fw-bold mb-2">₹{{ product.price }}</p>

          {% if w.is_purchased %}
            <span class="badge bg-success mb-3">Purchased</span>
          {% else %}
            <span class="badge bg-secondary mb-3">Not Purchased</span>
          {% endif %}

          <div class="mt-auto d-flex gap-2">
            <a href="#" class="btn btn-outline-dark btn-sm w-50">View</a>

            <form method="POST"
                  action="{{ url_for('user.toggle_wishlist', product_id=product.id) }}"
                  class="w-50">
              <button class="btn btn-outline-danger btn-sm w-100">
                ❤️ Remove
              </button>
            </form>
          </div>

        </div>
      </div>
    </div>
    {% else %}
      <div class="text-center text-muted py-5">
        <h5>No items in wishlist</h5>
        <p>Start adding products you love ❤️</p>
      </div>
    {% endfor %}
  </div>

</div>
{% endblock %}
